<!DOCTYPE html>
<html lang="en" itemscope="" itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8" />

  <title>Bulk redirection with Nginx · Saurabh Kumar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" user-scalable="no">

  <meta name="author" content="Saurabh Kumar">
  <meta name="copyright" content="Saurabh Kumar">

<meta name="description" content="Walkthrough of how you can utilize the power of nginx to setup mass redirects of random urls on your server">
<meta name="date" content="2017-09-25 16:43:00+05:30">

<meta name="keywords" content="devops, nginx, software, " />
<link rel="author" href=https://plus.google.com/+SaurabhKumar0/>  <meta name="twitter:creator" content="@_theskumar">
  <meta name="twitter:site" content="@_theskumar">

<meta itemprop="name" content="Bulk redirection with Nginx ">
<meta property="og:title" content="Bulk redirection with Nginx "/>
<meta property="og:url" content="https://saurabh-kumar.com/blog/bulk-redirect-with-nginx.html">
<meta property="og:description" content="Walkthrough of how you can utilize the power of nginx to setup mass redirects of random urls on your server">
<meta property="og:site_name" content="Saurabh Kumar">
<meta property="og:article:author" content="Saurabh Kumar">
 <meta property="og:article:published_time" content="2017-09-25T16:43:00+05:30"><meta name="twitter:title" content="Bulk redirection with Nginx ">
<meta name="twitter:description" content="Walkthrough of how you can utilize the power of nginx to setup mass redirects of random urls on your server">
<meta name="twitter:card" content="summary_large_image">
<meta property="og:image" content="https://images.unsplash.com/photo-1463267738627-d1a780134be7?dpr=1&auto=compress,format&fit=crop&w=1000&h=&q=80&cs=tinysrgb&crop=">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1463267738627-d1a780134be7?dpr=1&auto=compress,format&fit=crop&w=1000&h=&q=80&cs=tinysrgb&crop=">




  <link rel="stylesheet" href="https://saurabh-kumar.com/blog/theme/css/main.f.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">


  <link href="https://saurabh-kumar.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Saurabh Kumar Full Atom Feed" />

</head>

<body class=" article page-single has-featured-image software">

    <header>
        <div class='site_info'>
          <a href="https://saurabh-kumar.com/blog" class='logo'>
                <img src="https://1.gravatar.com/avatar/fc974e2829eac6e3512a9d7f82e04723?s=160" alt="logo">
          </a>
          <div class="info">
            <h2><a href="https://saurabh-kumar.com/blog">Saurabh Kumar</a></h2>
            <p>Thoughts and Writings</p>
          </div>
        </div>

        <div class="subscribe">
            <a class="subscribe-button icon-feed" href="https://saurabh-kumar.com/blog/feeds/all.atom.xml">Subscribe</a>
        </div>
    </header>
    <div class="blogPosting-featured_image" style="background-image: url(https://images.unsplash.com/photo-1463267738627-d1a780134be7?dpr=1&auto=compress,format&fit=crop&w=1000&h=&q=80&cs=tinysrgb&crop=)">
        <div class="featured_image--info_box">
            <h1 itemprop="headline">Bulk redirection with&nbsp;Nginx</h1>
            <p class='summary'><p>Walkthrough of how you can utilize the power of nginx to setup mass redirects of random urls on your&nbsp;server</p></p>
            <p>IN               <a href="https://saurabh-kumar.com/blog/tag/devops.html">devops</a>,              <a href="https://saurabh-kumar.com/blog/tag/nginx.html">nginx</a>            </p>
            <time datetime="2017-09-25 16:43:00+05:30" itemprop="datePublished">September 25, 2017</time>.
        </div>
    </div>

    <main role=main>
<article itemscope itemtype="http://schema.org/BlogPosting" class='blogPosting'>
  <div id="article_text" itemprop="articleBody" class='blogPosting-text'>
    <p>In this post, I am going to talk about how you can setup a redirects on a server for many individual paths. It uses the hash&nbsp;map</p>
<h4 id="creating-files">Creating&nbsp;files</h4>
<p>Create a file called <code>redirects-map.conf</code>, each line of the file will represents a redirect rule. The format of line&nbsp;is:</p>
<pre><code>&lt;old_location&gt; &lt;new_url&gt;;
</code></pre>

<p><code>old_location</code> can be specified in both regex or plan simple&nbsp;path.</p>
<p>The regex version looks likes&nbsp;this:</p>
<pre><code>~^/showcase/(.*)?$ /projects/;
</code></pre>

<p>The plan simple location redirect will look&nbsp;like:</p>
<pre><code>/contact-success/ /contact;
</code></pre>

<p>So your <code>redirects-map.conf</code> file should look&nbsp;like:</p>
<pre><code>/contact-success/ /contact;
~^/showcase/(.*)?$ /projects/;
</code></pre>

<h4 id="setting-up-nginx">Setting up&nbsp;nginx</h4>
<ol>
<li>Upload the <code>redirects-map.conf</code> to your server at <code>/etc/nginx</code></li>
<li>Add the following at the top of your nginx virtualhost file, which imports the file and creates a hash&nbsp;map:</li>
</ol>
<pre><code>map $uri $redirected_url {
    default &quot;none&quot;;
    include /etc/nginx/redirects-map.conf;
}
</code></pre>

<p>Then in the <code>server</code> block, write the following&nbsp;rule:</p>
<pre><code># pre-defined redirects
if ($redirected_url != &quot;none&quot;) {
    rewrite ^ $redirected_url permanent;
}
</code></pre>

<p>Now your virtualhost conf file should look&nbsp;like:</p>
<pre><code>map $uri $redirected_url {
    default &quot;none&quot;;
    include /etc/nginx/redirects-map.conf;
}

server {
    listen        443 ssl http2;
    server_name   example.org;

    # pre-defined redirects
    if ($redirected_url != &quot;none&quot;) {
        rewrite ^ $redirected_url permanent;
    }

    # rest of the rules

}
</code></pre>

<p><strong>Note</strong>: Nginx has a limit on how big the redirects-map.conf can be, which is controlled via <code>map_hash_bucket_size</code> variable. If you get the following error, <code>[emerg]: could not build the map_hash</code>, you should increase the <code>map_hash_bucket_size</code> to account for the filesize. Say your redirects-map.conf is 30Kb, you set the <code>map_hash_bucket_size</code> variable in the <code>http</code> block of <code>nginx.conf</code> to <code>30720</code>;</p>
  </div>
  <style>.promo {
    text-align: left;
    border: 1px solid #E3E5E4;
    background: #F3F4EE;
    padding: 5px 15px;
    position: relative;
    margin-left: 73px;
    margin-top: 20px;
}
.promo img {
    position: absolute;
    left: -67px;
    width: 60px;
    top: -17px;
}
.promo .tweet {
    position: absolute;
    right: 0px;
    top: 4px;
    width: 95px;
}
</style>
<div style="border-bottom: 1px dashed #CCC;">&nbsp;</div>
<div class="promo">
    <img src="http://blog.vjeux.com/wp-content/themes/coogee/images/at-twitter.png" />
    <div class="tweet">
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="_theskumar">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
    If you liked this article, you might be interested in my <a href="http://www.twitter.com/_theskumar/" target="_blank">Twitter feed</a> as well.
</div>
<div style="border-bottom: 1px dashed #CCC;">&nbsp;</div>


    <div class='blogPosting-comment' id="article_comments" style="display:block">
        <div id="disqus_thread"></div>
        <script>
            var disqus_identifier = "bulk-redirect-with-nginx.html";
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://saurabhkumar.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
    </div>

</article>
    </main>
    <footer>
<p><a href="https://saurabh-kumar.com/blog/" class="button_accent">&larr; Back</a></p>
        <div id="ending_message" class='clearfix'>
            <section class='copyright'>
                <a rel="license" target="blank" href="https://creativecommons.org/licenses/by/4.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
            </section>
            <section class='builtby'>
                Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Saurabh Kumar on <a href="https://github.com/theskumar/pelican-svbtle-responsive" target="_blank">github</a>.
            </section>
        </div>
    </footer>

<script>
function addLink() {
    var body_element = document.getElementsByTagName('body')[0],
        selection = window.getSelection(),
        pagelink = "<br><br>Read more at: <a href='"+document.location.href+"'>"+document.location.href+"</a>",
        copytext = selection + pagelink,
        newdiv = document.createElement('div');
    newdiv.style.position='absolute';
    newdiv.style.left='-99999px';
    body_element.appendChild(newdiv);
    newdiv.innerHTML = copytext;
    selection.selectAllChildren(newdiv);
    window.setTimeout(function() {
        body_element.removeChild(newdiv);
    },0);
}

// register the listener.
document.getElementById('article_text').oncopy = addLink;
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" data-no-instant></script>
  <script src="https://saurabh-kumar.com/blog/theme/js/main.min.js"></script>
  <script data-no-instant>
    InstantClick.init();
  </script>
  <script>
    // initialize fitvids
    $(document).ready(function(){$("body").fitVids();});
  </script>
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='https://www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-26681217-2','auto');ga('send','pageview');
</script>
</body>
</html>